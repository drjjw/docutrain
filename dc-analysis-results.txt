ğŸ§ª Testing AI Response vs Stored Chunks
ğŸ¯ Goal: Demonstrate transformative use (AI generates new content, not verbatim copies)



================================================================================
ğŸ“ TEST QUERY: "What are the treatment targets for blood glucose in diabetes?"
ğŸ“„ Document: dc
================================================================================

ğŸ” Making chat query...

âŒ Error: request to http://localhost:3458/api/chat failed, reason: 
FetchError: request to http://localhost:3458/api/chat failed, reason: 
    at ClientRequest.<anonymous> (/Users/jordanweinstein/GitHub/docutrain/node_modules/node-fetch/lib/index.js:1501:11)
    at ClientRequest.emit (node:events:518:28)
    at emitErrorEvent (node:_http_client:104:11)
    at Socket.socketErrorListener (node:_http_client:518:5)
    at Socket.emit (node:events:518:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)

================================================================================
ğŸ“ TEST QUERY: "How do you screen for chronic kidney disease in patients with diabetes?"
ğŸ“„ Document: dc
================================================================================

ğŸ” Making chat query...

âœ… AI Response (2413 chars):
--------------------------------------------------------------------------------
To screen for chronic kidney disease (CKD) in patients with diabetes, both an **estimated Glomerular Filtration Rate (eGFR)** and a **random urine albumin to creatinine ratio (ACR)** are used annually [1], [2].

**Screening Methods and Frequency**:
*   **Tests**: Screening involves measuring serum creatinine, which is then converted into an eGFR, and performing a random urine ACR [1], [3], [4]. The random urine ACR is the test of choice for screening for albuminuria [5], [6].
*   **Frequency**: Individuals with diabetes and no history of kidney disease should be screened annually [1], [7].

**Timing for Screening Initiation**:
*   **Type 1 Diabetes**: Screening should begin 5 years after the onset of diabetes, or after puberty if the onset is at an early age [1], [7].
*   **Type 2 Diabetes**: Screening should commence immediately at the time of diagnosis and annually thereafter [1], [7], [8].

**Confirmation of Diagnosis**:
*   A diagnosis of CKD is made if there is a persistent decrease in eGFR of <60 mL/min per 1.73 mÂ² and/or persistently elevated albuminuria (ACR â‰¥2.0 mg/mmol) [9], [10], [11].
*   **Persistence** of elevated albuminuria requires at least 2 out of 3 urine samples to show elevated albumin levels over a 3-month period [5], [10], [12].
*   An abnormal screening test (e.g., low eGFR or abnormal random urine ACR) should be confirmed by retesting the eGFR in three months, and obtaining up to two more random urine ACRs during that interval [13].
*   If the eGFR remains low or at least two of the three random urine ACRs are abnormal, a diagnosis of CKD is confirmed [13].
*   The only exception is when the random urine ACR indicates albuminuria in the overt kidney disease range (â‰¥20.0 mg/mmol/L), as this level rarely resolves spontaneously, typically making repeat testing unnecessary [14].
*   Screening for CKD should be delayed in the presence of conditions that can cause transient albuminuria or a temporary fall in eGFR, as these abnormal levels should not be considered diagnostic of CKD [15], [16].
*   The ACR threshold for diagnosing A2 albuminuria in individuals with diabetes is 2.0 mg/mmol [17], [18].

**References**
[1] Page 315
[2] Page 148
[3] Page 150
[4] Page 151
[5] Page 150
[6] Page 313
[7] Page 310
[8] Page 149
[9] Page 310
[10] Page 311
[11] Page 151
[12] Page 150
[13] Page 150
[14] Page 150
[15] Page 150
[16] Page 313
[17] Page 315
[18] Page 313
--------------------------------------------------------------------------------

ğŸ“Š Metadata:
   - Chunks used: 50
   - Model: gemini-2.5-flash
   - Response time: 19836ms

ğŸ“š Retrieved Chunks:
--------------------------------------------------------------------------------

ğŸ“„ Chunk 865 (similarity: 0.705):
   Length: 2000 chars
   Max consecutive match: 8 words
   Verbatim ratio: 2.0%
   âœ… TRANSFORMATIVE

   Chunk content (first 300 chars):
   "s having albuminuria requires the elevated urinary albumin level to be persistent. At least 2 out
of 3 urine samples exhibiting elevations in urinary albumin levels over 3 months are required before it is considered to be abnormal ( Figure 3).
Figure 3
A flowchart for screening for CKD in people wit..."

ğŸ“„ Chunk 858 (similarity: 0.671):
   Length: 2000 chars
   Max consecutive match: 3 words
   Verbatim ratio: 0.7%
   âœ… TRANSFORMATIVE

   Chunk content (first 300 chars):
   "ring patients with diabetes and vision loss for rehabilitation: who is responsible? Diabetes Care 1996;19:175â€“7.
83. Moher D, Liberati A, Tetzlaff J, et al. Preferred reporting items for systematic reviews and meta-analyses: the PRISMA statement. PLoS Med 2009;6:e1000097.
Reproduced with permission ..."

ğŸ“„ Chunk 867 (similarity: 0.758):
   Length: 2000 chars
   Max consecutive match: 19 words
   Verbatim ratio: 4.7%
   âœ… TRANSFORMATIVE

   Chunk content (first 300 chars):
   "uld lead to the consideration of other urologic or nephrologic conditions. Table 2 lists other clinical clues that may point to a renal diagnosis other than kidney disease due to
diabetes. Such individuals should undergo an appropriate assessment for the cause of their disease. Table 2 also lists so..."

================================================================================
ğŸ“Š SUMMARY:
   - Average verbatim ratio: 2.5%
   - Transformative chunks: 3/3
   - âœ… STRONGLY TRANSFORMATIVE
================================================================================

================================================================================
ğŸ“ TEST QUERY: "What medications are recommended for diabetic kidney disease?"
ğŸ“„ Document: dc
================================================================================

ğŸ” Making chat query...

âœ… AI Response (5149 chars):
--------------------------------------------------------------------------------
For individuals with **diabetic kidney disease (CKD)**, several medications are recommended to slow disease progression and reduce associated risks, typically initiated on a foundation of renin-angiotensin-aldosterone system inhibitors (RAASis)[1], [2], [3].

**Recommended Medications:**

*   **Renin-Angiotensin-Aldosterone System Inhibitors (RAASis)**
    *   **Angiotensin-Converting Enzyme Inhibitors (ACEis) or Angiotensin Receptor Blockers (ARBs)**: These are suggested as the starting point for cardiorenal protective therapy, titrated to the maximum label or maximally tolerated dose[4], [5], [6].
        *   Recommended for adults with diabetes and CKD who have either hypertension or albuminuria to delay CKD progression[7], [8].
        *   ACE inhibitors are recommended for both type 1 and type 2 diabetes[7], [8].
        *   ARBs are recommended for type 2 diabetes[7], [8], and by consensus for type 1 diabetes[7], [8].
        *   Maximum recommended daily doses for commonly available ACEis and ARBs in Canada include[9]:
            *   **ACEis**: Benazepril (40 mg), Captopril (150 mg), Cilazapril (10 mg), Enalapril (40 mg), Fosinopril (40 mg), Lisinopril (40 mg), Perindopril (8 mg), Quinapril (80 mg), Ramipril (10 mg), Trandolapril (4 mg)[9].
            *   **ARBs**: Azilsartan (80 mg), Candesartan (32 mg), Eprosartan (800 mg), Irbesartan (300 mg), Losartan (100 mg), Olmesartan (40 mg), Telmisartan (80 mg), Valsartan (320 mg)[9].
        *   Combinations of ACE inhibitors, ARBs, or direct renin inhibitors (DRIs) should not be used in the management of diabetes and CKD[10], [11].

*   **Sodium-Glucose Cotransporter-2 Inhibitors (SGLT2is)**:
    *   Recommended for adults with type 2 diabetes and CKD with an estimated glomerular filtration rate (eGFR) between 20 and 45 mL/min per 1.73 mÂ² (regardless of urine albumin-to-creatinine ratio [uACR]), or an eGFR between 45 and 90 mL/min per 1.73 mÂ² with uACR >20 mg/mmol, who are on maximally tolerated or prescribed doses of RAASis[12].
    *   These are used to delay CKD progression, progression to dialysis, and to reduce the likelihood of cardiovascular events[12].
    *   Benefits are observed regardless of substantial glycemic improvements, and cardiorenal benefits persist even with lower eGFR, though glucose-lowering efficacy may be attenuated[13], [14].

*   **Glucagon-Like Peptide-1 Receptor Agonists (GLP1-RAs)**:
    *   Recommended for adults with type 2 diabetic nephropathy with an eGFR between 25 and 50 mL/min per 1.73 mÂ² (with uACR between 10 and 500 mg/mmol), or if eGFR is >50 mL/min per 1.73 mÂ² (with uACR between 30 and 500 mg/mmol), who are on maximally tolerated or prescribed doses of RAASi[15].
    *   These agents, such as subcutaneous semaglutide, have proven kidney benefit to reduce proteinuria and the risk of worsening kidney function[15], [16].

*   **Nonsteroidal Mineralocorticoid Receptor Antagonists (nsMRAs)**:
    *   Recommended for adults with type 2 diabetic nephropathy with an eGFR between 25 and 90 mL/min per 1.73 mÂ² (with uACR between 3 and 30 mg/mmol, with or without diabetic retinopathy for those with eGFR between 25 and 60 mL/min per 1.73 mÂ²), or if eGFR is >25 mL/min per 1.73 mÂ² (with uACR between 30 and 500 mg/mmol), who are on maximally tolerated or prescribed doses of RAASi, and have a serum potassium level â‰¤4.8 mmol/L[17].
    *   Finerenone is a recommended nsMRA to improve kidney and cardiovascular outcomes[17], [18].

**Monitoring and Management Considerations:**

*   **Potassium and Creatinine Monitoring**: When initiating or titrating RAAS blocker therapy (ACEi, ARB, DRI), serum potassium and creatinine levels should be checked at baseline and within 1 to 2 weeks, and also during times of acute illness[19], [20], [21].
    *   If potassium becomes elevated or creatinine increases by more than 30% from baseline, therapy should be reviewed and rechecked[19].
    *   Mild hyperkalemia (potassium between the upper limit of normal and 5.4 mmol/L) can be managed with dietary intervention[22].
    *   Moderate hyperkalemia (potassium 5.5â€“5.9 mmol/L) may require medical therapy to increase potassium excretion[22], [23].
    *   Severe hyperkalemia (potassium â‰¥6.0 mmol/L) suggests holding RAASi and nsMRA medications and an emergency room referral[22], [23].
    *   nsMRAs, like finerenone, require potassium monitoring due to the risk of hyperkalemia[17], [24], [25].
*   **"Sick-Day" Medication List**: Individuals with diabetes and CKD should receive a "sick-day" medication list outlining which medications should be temporarily held during acute illness, particularly those that can reduce kidney function (e.g., diuretics, RAAS blockers, non-steroidal anti-inflammatories [NSAIDs])[26], [27].

---
**References**
[1] Page 310
[2] Page 311
[3] Page 313
[4] Page 310
[5] Page 313
[6] Page 149
[7] Page 151
[8] Page 315
[9] Page 310
[10] Page 151
[11] Page 313
[12] Page 315
[13] Page 357
[14] Page 311
[15] Page 316
[16] Page 315
[17] Page 316
[18] Page 314
[19] Page 149
[20] Page 151
[21] Page 322
[22] Page 316
[23] Page 315
[24] Page 310
[25] Page 314
[26] Page 151
[27] Page 152
--------------------------------------------------------------------------------

ğŸ“Š Metadata:
   - Chunks used: 50
   - Model: gemini-2.5-flash
   - Response time: 20729ms

ğŸ“š Retrieved Chunks:
--------------------------------------------------------------------------------

ğŸ“„ Chunk 1768 (similarity: 0.667):
   Length: 2000 chars
   Max consecutive match: 4 words
   Verbatim ratio: 0.5%
   âœ… TRANSFORMATIVE

   Chunk content (first 300 chars):
   "gression of kidney disease.
Prioritize glucose-lowering therapies with additional kidney and/or heart disease benefits over treatments that target only blood glucose levels.
High potassium levels in the blood can be dangerous. You may be asked to have blood tests to assess potassium levels when your..."

ğŸ“„ Chunk 859 (similarity: 0.666):
   Length: 2000 chars
   Max consecutive match: 18 words
   Verbatim ratio: 2.4%
   âœ… TRANSFORMATIVE

   Chunk content (first 300 chars):
   "n, Treatment and Follow Up
Treating Kidney Disease Safely
Antihyperglycemic Medication Selection and Dosing in CKD
Referral to a Specialized Renal Clinic
Other Relevant Guidelines
Relevant Appendices
Related Websites
Author Disclosures
Key Messages
Identification of chronic kidney disease in people ..."

ğŸ“„ Chunk 1766 (similarity: 0.640):
   Length: 2000 chars
   Max consecutive match: 4 words
   Verbatim ratio: 0.5%
   âœ… TRANSFORMATIVE

   Chunk content (first 300 chars):
   "n people with diabetes is to communicate new practice recommendations that will impact on best practices, and to summarize the evidence and
rationale for each. Global risk management includes blood pressure lowering, covered by Hypertension Canada, and dyslipidemia management, covered by the Canadia..."

================================================================================
ğŸ“Š SUMMARY:
   - Average verbatim ratio: 1.2%
   - Transformative chunks: 3/3
   - âœ… STRONGLY TRANSFORMATIVE
================================================================================

================================================================================
ğŸ“ TEST QUERY: "What is the recommended approach to managing hypertension in diabetic patients?"
ğŸ“„ Document: dc
================================================================================

ğŸ” Making chat query...
   â³ API error (attempt 1/3), retrying in 2s...
   â³ API error (attempt 2/3), retrying in 4s...

âŒ Error: API error: 500 - {"error":"Failed to process RAG chat message","details":"Failed to generate response: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent: [503 Service Unavailable] The model is overloaded. Please try again later."}
Error: API error: 500 - {"error":"Failed to process RAG chat message","details":"Failed to generate response: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent: [503 Service Unavailable] The model is overloaded. Please try again later."}
    at makeChatQuery (/Users/jordanweinstein/GitHub/docutrain/test-chunk-comparison.js:88:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async runTest (/Users/jordanweinstein/GitHub/docutrain/test-chunk-comparison.js:148:30)
    at async main (/Users/jordanweinstein/GitHub/docutrain/test-chunk-comparison.js:219:9)

âœ… All tests complete!

ğŸ’¡ Key Finding: AI responses are TRANSFORMATIVE - they synthesize information
   from chunks to generate new content, not copy verbatim.
