<meta name="description" content="Access AI-powered clinical practice guidelines for nephrology: KDIGO, ISPD, and Diabetes Canada. Get instant, evidence-based answers about kidney disease management, peritoneal dialysis, and diabetes care.">
<!-- Hero Section -->
<div class="uk-section uk-section-default" style="background: #ffffff; padding-top: 40px; padding-bottom: 40px;">
	<div class="uk-container uk-container-large">
		<div class="uk-grid uk-grid-large uk-flex-middle" data-uk-grid>
			<div class="uk-width-3-5@m uk-width-1-1@s">
				<div style="position: relative; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);">
					<img src="https://ukidney.com/images/ukidney-ai-guidelines.webp" alt="Nephrology Guidelines - KDIGO, Diabetes Canada, ISPD - UKidney AI Guidelines" style="width: 100%; height: auto; display: block;" />
					<div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0, 0, 0, 0.75) 0%, rgba(0, 0, 0, 0.4) 50%, transparent 100%); padding: 40px 32px 32px; color: white;">
						<h2 style="margin: 0; font-size: 32px; font-weight: 700; color: #ffffff; letter-spacing: -0.5px; line-height: 1.2; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);">Nephrology AI Assisted Clinical Practice Guidelines</h2>
					</div>
				</div>
			</div>
			<div class="uk-width-2-5@m uk-width-1-1@s">
				<div>
					<h2 style="font-size: 36px; font-weight: 700; color: #1a1a1a; letter-spacing: -0.5px; line-height: 1.2; margin-bottom: 24px;">Nephrology Guidelines Powered Up</h2>
					<p>
						Access evidence-based clinical practice guidelines through AI-powered assistants trained on comprehensive guideline databases from KDIGO, ISPD, and Diabetes Canada. Get instant answers to your questions about kidney disease management, peritoneal dialysis, and diabetes care using natural language queries.
					</p>
					<p>
						Our assistants provide evidence-based responses sourced directly from clinical protocols, helping you find specific recommendations, treatment protocols, diagnostic criteria, and management strategies without navigating lengthy PDFs.
					</p>
					<p style="display: flex; align-items: flex-start; gap: 10px;">
						<i class="fa-solid fa-globe" style="font-size: 18px; color: #0066cc; margin-top: 2px; flex-shrink: 0;"></i>
						<span><strong>Multilingual Support:</strong> Ask questions in any language and receive responses in the same language.</span>
					</p>
				</div>
			</div>
		</div>
		<div class="guideline-disclaimer" style="width: 100%; margin-top: 32px; padding: 20px 24px; background: #f8f8f8; border-radius: 8px; border: 1px solid #e8e8e8; box-sizing: border-box;">
			<p style="text-align: center; margin: 0; padding: 0;">
				<strong style="font-size: 14px; line-height: 1.5;">These guideline assistants were generated by training our AI assistants on publicly available guideline information.</strong>
			</p>
		</div>
	</div>
</div>

<!-- Main Content Section -->
<div class="uk-section uk-section-default">
	<div class="uk-container uk-container-large">
		
		<!-- Main Card -->
		<div class="uk-card uk-card-default uk-card-body" style="border-radius: 12px; border: 1px solid #e0e0e0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); background: #ffffff;">
			
			<!-- Guidelines Cards Section -->
			<div class="uk-margin-small-top uk-margin-large-bottom">
				<h2 class="uk-h2 uk-text-center uk-margin-large-bottom" style="color: #1a1a1a; font-weight: 600; font-size: 32px; letter-spacing: -0.3px; margin-bottom: 48px;">Available Guidelines</h2>
				<div class="uk-grid-match uk-child-width-1-3@m uk-child-width-1-1@s uk-margin-medium" data-uk-grid>
					
					<!-- KDIGO Guidelines Card -->
				<div>
						<div class="uk-card uk-card-body uk-text-center guideline-card" data-guideline="kdigo" style="background: #ffffff; border-radius: 12px; padding: 40px 32px; border: 1px solid #e0e0e0; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); min-height: 380px; display: flex; flex-direction: column; height: 100%;">
							<div style="position: absolute; top: 0; left: 0; right: 0; height: 5px; background: linear-gradient(90deg, #cc0000 0%, #e63946 100%);"></div>
							<div style="margin-bottom: 32px;">
								<h3 class="uk-h3 uk-margin-remove-bottom" style="font-weight: 700; color: #1a1a1a; font-size: 28px; letter-spacing: -0.3px; text-align: center; margin-bottom: 8px;">KDIGO Guidelines</h3>
								<p class="uk-margin-remove" style="font-size: 15px; color: #888; text-align: center; font-weight: 500;">2009-2025</p>
							</div>
							<p class="uk-margin-medium-bottom" style="flex-grow: 1; text-align: center;">
								Kidney Disease: Improving Global Outcomes clinical practice guidelines for comprehensive kidney disease management.
							</p>
							<ul style="text-align: left; margin: 0 auto 24px; padding: 0; list-style: none; max-width: 90%;">
								<li>• Summaries of CKD, dialysis, and transplant recommendations</li>
								<li>• Quickly locate workup algorithms and dosing tables</li>
								<li>• Cross-reference KDIGO nephrology guidelines with local policies</li>
							</ul>
							<button class="uk-button uk-button-default guideline-button" data-guideline="kdigo" style="background: #cc0000; color: white; font-weight: 600; padding: 14px 28px; transition: all 0.2s ease; border: none; margin-top: auto; border-radius: 8px; font-size: 16px; text-align: center; width: 100%; justify-content: center; box-shadow: 0 2px 6px rgba(204, 0, 0, 0.2); cursor: pointer;">
								<span style="display: flex; align-items: center; justify-content: center; gap: 10px;">
									<span>Open Assistant</span>
									<i class="fa-solid fa-arrow-right" style="font-size: 13px;"></i>
								</span>
							</button>
						</div>
					</div>

					<!-- ISPD Guidelines Card -->
					<div>
						<div class="uk-card uk-card-body uk-text-center guideline-card" data-guideline="ispd" style="background: #ffffff; border-radius: 12px; padding: 40px 32px; border: 1px solid #e0e0e0; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); min-height: 380px; display: flex; flex-direction: column; height: 100%;">
							<div style="position: absolute; top: 0; left: 0; right: 0; height: 5px; background: linear-gradient(90deg, #0066cc 0%, #4a90e2 100%);"></div>
							<div style="margin-bottom: 32px;">
								<h3 class="uk-h3 uk-margin-remove-bottom" style="font-weight: 700; color: #1a1a1a; font-size: 28px; letter-spacing: -0.3px; text-align: center; margin-bottom: 8px;">ISPD Guidelines</h3>
								<p class="uk-margin-remove" style="font-size: 15px; color: #888; text-align: center; font-weight: 500;">2005-2023</p>
				</div>
							<p class="uk-margin-medium-bottom" style="flex-grow: 1; text-align: center;">
								International Society for Peritoneal Dialysis clinical practice guidelines for peritoneal dialysis management.
							</p>
							<ul style="text-align: left; margin: 0 auto 24px; padding: 0; list-style: none; max-width: 90%;">
								<li>• Protocols for acute and chronic PD complications</li>
								<li>• ISPD guidance on infection prevention and peritonitis</li>
								<li>• Practical tips for patient eligibility and modality selection</li>
							</ul>
							<button class="uk-button uk-button-default guideline-button" data-guideline="ispd" style="background: #0066cc; color: white; font-weight: 600; padding: 14px 28px; transition: all 0.2s ease; border: none; margin-top: auto; border-radius: 8px; font-size: 16px; text-align: center; width: 100%; justify-content: center; box-shadow: 0 2px 6px rgba(0, 102, 204, 0.2); cursor: pointer;">
								<span style="display: flex; align-items: center; justify-content: center; gap: 10px;">
									<span>Open Assistant</span>
									<i class="fa-solid fa-arrow-right" style="font-size: 13px;"></i>
								</span>
							</button>
						</div>
					</div>

					<!-- Diabetes Canada Guidelines Card -->
					<div>
						<div class="uk-card uk-card-body uk-text-center guideline-card" data-guideline="diabetes-canada" style="background: #ffffff; border-radius: 12px; padding: 40px 32px; border: 1px solid #e0e0e0; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); min-height: 380px; display: flex; flex-direction: column; height: 100%;">
							<div style="position: absolute; top: 0; left: 0; right: 0; height: 5px; background: linear-gradient(90deg, #00a651 0%, #2ecc71 100%);"></div>
							<div style="margin-bottom: 32px;">
								<h3 class="uk-h3 uk-margin-remove-bottom" style="font-weight: 700; color: #1a1a1a; font-size: 28px; letter-spacing: -0.3px; text-align: center; margin-bottom: 8px;">Diabetes Canada</h3>
								<p class="uk-margin-remove" style="font-size: 15px; color: #888; text-align: center; font-weight: 500;">2018-2025</p>
				</div>
							<p class="uk-margin-medium-bottom" style="flex-grow: 1; text-align: center;">
								Clinical Practice Guidelines for the Prevention and Management of Diabetes in Canada.
							</p>
							<ul style="text-align: left; margin: 0 auto 24px; padding: 0; list-style: none; max-width: 90%;">
								<li>• Diabetes Canada recommendations on screening and diagnosis</li>
								<li>• Pharmacologic therapy pathways tailored to renal function</li>
								<li>• Integrated care plans for diabetes, CKD, and cardiovascular risk</li>
							</ul>
							<button class="uk-button uk-button-default guideline-button" data-guideline="diabetes-canada" style="background: #00a651; color: white; font-weight: 600; padding: 14px 28px; transition: all 0.2s ease; border: none; margin-top: auto; border-radius: 8px; font-size: 16px; text-align: center; width: 100%; justify-content: center; box-shadow: 0 2px 6px rgba(0, 166, 81, 0.2); cursor: pointer;">
								<span style="display: flex; align-items: center; justify-content: center; gap: 10px;">
									<span>Open Assistant</span>
									<i class="fa-solid fa-arrow-right" style="font-size: 13px;"></i>
								</span>
							</button>
						</div>
					</div>

				</div>
			</div>
		
			<!-- Unified Information Section -->
			<div class="uk-margin-large-top" style="margin-top: 64px;">
				<div class="uk-card uk-card-default uk-card-body" style="border-radius: 12px; background: #f8f8f8; border: 1px solid #e8e8e8; padding: 48px 40px;">
					<div class="uk-grid uk-grid-large uk-flex-middle" data-uk-grid>
						<div class="uk-width-2-3@m uk-width-1-1@s">
							<h3 class="uk-h3 uk-margin-small-bottom">How It Works</h3>
							<p>
								Our AI assistants are trained on comprehensive guideline databases from leading medical organizations. Simply ask questions in natural language to get instant, evidence-based answers sourced directly from clinical protocols. Whether you need treatment recommendations, diagnostic criteria, or management strategies, our assistants help you navigate complex guideline content efficiently.
							</p>
						</div>
						<div class="uk-width-1-3@m uk-width-1-1@s">
							<div style="background: #ffffff; border-radius: 8px; padding: 32px 24px; border: 1px solid #e0e0e0;">
								<h4 class="uk-h4 uk-margin-small-bottom" style="text-align: center;">Guideline Sources</h4>
								<div style="display: flex; flex-direction: column; gap: 16px;">
									<a href="https://kdigo.org/" target="_blank" style="text-align: center;">KDIGO nephrology guidelines</a>
									<a href="https://ispd.org/" target="_blank" style="text-align: center;">ISPD peritoneal dialysis guidelines</a>
									<a href="https://www.diabetes.ca/" target="_blank" style="text-align: center;">Diabetes Canada clinical practice guidelines</a>
									<div style="border-top: 1px solid #e0e0e0; margin-top: 8px; padding-top: 16px;">
										<p style="text-align: center;">AI assistance provided by <a href="https://www.docutrain.io" target="_blank">DocuTrain</a>.</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- FAQ Section -->
			<div class="uk-margin-large-top" style="margin-top: 64px;">
				<div class="uk-card uk-card-default uk-card-body" style="border-radius: 12px; border: 1px solid #e0e0e0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); background: #ffffff; padding: 48px 40px;">
					<h3 class="uk-h3 uk-text-center" style="margin-bottom: 36px;">Nephrology Guidelines FAQ</h3>
					<div class="uk-grid uk-grid-large" data-uk-grid>
						<div class="uk-width-1-2@m uk-width-1-1@s">
							<h4 class="uk-h4">What are KDIGO nephrology guidelines?</h4>
							<p>
								KDIGO (Kidney Disease: Improving Global Outcomes) publishes global nephrology guidelines covering CKD, AKI, dialysis, and transplant care. Our assistant quickly surfaces recommendations, grading, and rationale paragraphs so you can cite the latest evidence.
							</p>
						</div>
						<div class="uk-width-1-2@m uk-width-1-1@s">
							<h4 class="uk-h4">How can I use ISPD guidelines in practice?</h4>
							<p>
								The International Society for Peritoneal Dialysis guidelines offer detailed protocols for catheter care, peritonitis management, and modality selection. Ask the assistant about specific scenarios to receive protocol summaries and references.
							</p>
						</div>
						<div class="uk-width-1-2@m uk-width-1-1@s">
							<h4 class="uk-h4">Where can I find Diabetes Canada guideline updates?</h4>
							<p>
								Diabetes Canada releases annual updates on screening, treatment targets, and pharmacotherapy. The assistant highlights the most recent Diabetes Canada guideline updates and links back to the relevant sections for deeper reading.
							</p>
						</div>
						<div class="uk-width-1-2@m uk-width-1-1@s">
							<h4 class="uk-h4">Can I compare KDIGO, ISPD, and Diabetes Canada guidance?</h4>
							<p>
								Yes. Ask comparative questions and the assistant will surface relevant passages from each guideline set so you can align nephrology, peritoneal dialysis, and diabetes recommendations for complex patients.
							</p>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>

<!-- Chat Modal -->
<div id="manual-assistant-modal" class="modern-modal-overlay">
	<div class="modern-modal-backdrop" onclick="closeChatModal()"></div>
	<div class="modern-modal-panel">
		<button class="modern-close-button" type="button" onclick="closeChatModal()" aria-label="Close chat">
			<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
				<line x1="18" y1="6" x2="6" y2="18"></line>
				<line x1="6" y1="6" x2="18" y2="18"></line>
			</svg>
		</button>
		<div class="modern-modal-body">
		<iframe 
			id="chat-iframe"
				src="about:blank"
				class="modern-iframe"
			allow="clipboard-write"
			title="Chat Assistant">
		</iframe>
		</div>
	</div>
</div>

<style>
	/* Hover effects for guideline cards */
	.guideline-card {
		position: relative;
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	}
	
	.guideline-card:hover {
		transform: translateY(-6px);
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12) !important;
		border-color: #d0d0d0 !important;
	}

	.guideline-card[data-guideline="kdigo"]:hover {
		border-color: #cc0000 !important;
		box-shadow: 0 8px 24px rgba(204, 0, 0, 0.15) !important;
	}

	.guideline-card[data-guideline="ispd"]:hover {
		border-color: #0066cc !important;
		box-shadow: 0 8px 24px rgba(0, 102, 204, 0.15) !important;
	}

	.guideline-card[data-guideline="diabetes-canada"]:hover {
		border-color: #00a651 !important;
		box-shadow: 0 8px 24px rgba(0, 166, 81, 0.15) !important;
	}

	.guideline-button {
		display: flex;
		align-items: center;
	}

	.guideline-button:hover {
		opacity: 0.95;
		transform: translateX(3px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25) !important;
	}

	.guideline-button:active {
		transform: translateX(1px);
		opacity: 0.9;
	}

	/* Modern Modal Styles */
	.modern-modal-overlay {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		width: 100%;
		height: 100%;
		z-index: 99999 !important; /* Ensure highest z-index */
		opacity: 0;
		visibility: hidden;
		pointer-events: none;
		display: none; /* Completely hidden on page load */
		/* No transition on initial load - only when opening */
		transition: none;
	}

	.modern-modal-overlay.active {
		display: block; /* Show when active */
		opacity: 1;
		visibility: visible;
		pointer-events: all;
		/* Enable transition only when active */
		transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.4s;
	}

	.modern-modal-backdrop {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0, 0, 0, 0.6);
		backdrop-filter: blur(12px);
		-webkit-backdrop-filter: blur(12px);
		opacity: 0;
		/* Transition enabled for closing animation */
		transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.modern-modal-overlay.active .modern-modal-backdrop {
		opacity: 1;
	}

	.modern-modal-panel {
		position: absolute;
		top: 0;
		right: 0;
		width: 100%;
		height: 100%;
		background: #ffffff;
		box-shadow: -8px 0 32px rgba(0, 0, 0, 0.15);
		display: flex;
		flex-direction: column;
		transform: translateX(100%);
		/* Transition enabled for closing animation */
		transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		overflow: hidden;
		position: relative;
	}

	.modern-modal-overlay.active .modern-modal-panel {
		transform: translateX(0);
		/* Enable transition only when active */
		transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.modern-close-button {
		position: absolute;
		top: 20px;
		right: 20px;
		width: 44px;
		height: 44px;
		background: rgba(255, 255, 255, 0.95);
		border: 1px solid rgba(0, 0, 0, 0.1);
		border-radius: 12px;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		color: #333;
		transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
		padding: 0;
		backdrop-filter: blur(10px);
		-webkit-backdrop-filter: blur(10px);
		z-index: 10000;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	}

	.modern-close-button:hover {
		background: rgba(255, 255, 255, 1);
		border-color: rgba(0, 0, 0, 0.2);
		transform: scale(1.05) rotate(90deg);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	}

	.modern-close-button:active {
		transform: scale(0.95) rotate(90deg);
	}

	.modern-modal-body {
		flex: 1;
		overflow: hidden;
		position: relative;
		background: #ffffff;
	}

	.modern-iframe {
		width: 100%;
		height: 100%;
		border: none;
		display: block;
		opacity: 0;
		visibility: hidden;
		transition: opacity 0.3s ease 0.2s, visibility 0s 0.5s;
	}

	.modern-modal-overlay.active .modern-iframe {
		opacity: 1;
		visibility: visible;
		transition: opacity 0.3s ease 0.2s, visibility 0s 0s;
	}

	body.modern-modal-open {
		overflow: hidden;
	}

	/* Responsive Modal */
	@media (max-width: 768px) {
		.modern-close-button {
			top: 80px;
			right: 16px;
			width: 40px;
			height: 40px;
		}
	}

	/* Responsive adjustments */
	@media (max-width: 960px) {
		.guideline-card {
			min-height: auto !important;
			padding: 30px 20px !important;
		}
		
		.guideline-icon {
			font-size: 48px !important;
		}
	}

	/* Mobile responsive adjustments for disclaimer section */
	.guideline-disclaimer {
		width: 100%;
		box-sizing: border-box;
	}

	@media (max-width: 768px) {
		.guideline-disclaimer {
			padding: 16px 16px !important;
			margin-top: 24px !important;
		}
		
		.guideline-disclaimer p strong {
			font-size: 13px !important;
			line-height: 1.4 !important;
		}
	}

	@media (max-width: 480px) {
		.guideline-disclaimer {
			padding: 12px 12px !important;
			margin-top: 20px !important;
		}
		
		.guideline-disclaimer p strong {
			font-size: 12px !important;
			line-height: 1.4 !important;
		}
	}

</style>

<script type="text/javascript">
	let chatModalOpen = false;
	let isOpeningModal = false; // Guard to prevent multiple simultaneous calls
	let currentDocId = null;
	const docUrls = {
		'kdigo': 'https://www.docutrain.io/app/chat?doc=kdigo&footer=false&owner_link=false',
		'ispd': 'https://www.docutrain.io/app/chat?doc=ispd&footer=false&owner_link=false',
		'diabetes-canada': 'https://www.docutrain.io/app/chat?doc=dc&footer=false&owner_link=false'
	};

	window.addEventListener('message', function(event) {
		if (event.origin !== 'https://www.docutrain.io') return;
		
		if (event.data.type === 'headerCollapsed') {
			console.log('Header collapsed state:', event.data.collapsed);
		}
	});

	// Initialize guideline button click handlers
	document.addEventListener('DOMContentLoaded', function() {
		const guidelineButtons = document.querySelectorAll('.guideline-button');
		guidelineButtons.forEach(function(button) {
			// Single unified handler for all pointer events
			function handleButtonInteraction(e) {
				console.log('Button interaction:', e.type);
				e.preventDefault();
				e.stopPropagation();
				e.stopImmediatePropagation();
				const guidelineId = button.getAttribute('data-guideline');
				openChatModal(guidelineId, e);
				return false;
			}
			
			// Handle all pointer event types the same way
			button.addEventListener('click', handleButtonInteraction, { capture: true, passive: false });
			button.addEventListener('touchstart', handleButtonInteraction, { capture: true, passive: false });
			button.addEventListener('touchend', handleButtonInteraction, { capture: true, passive: false });
			button.addEventListener('pointerdown', handleButtonInteraction, { capture: true, passive: false });
			button.addEventListener('pointerup', handleButtonInteraction, { capture: true, passive: false });
		});

		// Prevent closing when clicking inside the panel
		const modalPanel = document.querySelector('.modern-modal-panel');
		if (modalPanel) {
			modalPanel.addEventListener('click', function(e) {
				e.stopPropagation();
			});
		}
	});

	function openChatModal(guidelineId, event) {
		console.log('openChatModal called', guidelineId, event);
		
		// Prevent multiple simultaneous calls
		if (isOpeningModal || chatModalOpen) {
			console.log('Modal already opening or open, ignoring duplicate call');
			return false;
		}
		
		// Prevent any default behavior FIRST - be very aggressive
		if (event) {
			event.preventDefault();
			event.stopPropagation();
			event.stopImmediatePropagation();
		}
		
		// Also prevent window navigation
		if (window.event) {
			window.event.preventDefault();
			window.event.stopPropagation();
		}
		
		if (!guidelineId) {
			guidelineId = 'kdigo'; // Default to KDIGO
		}

		const docUrl = docUrls[guidelineId];
		
		if (!docUrl) {
			console.error('Unknown guideline ID:', guidelineId);
			return false;
		}
		
		isOpeningModal = true;
		
		const modal = document.getElementById('manual-assistant-modal');
		const iframe = document.getElementById('chat-iframe');
		const body = document.body;
		
		if (!modal || !iframe) {
			console.error('Modal elements not found');
			isOpeningModal = false;
			return false;
		}
		
		console.log('Opening modal');
		
		// Show modal IMMEDIATELY - don't wait for iframe
		modal.style.display = 'block';
		modal.style.visibility = 'visible';
		modal.style.opacity = '1';
		modal.style.zIndex = '99999'; // Ensure it's on top
		body.classList.add('modern-modal-open');
		chatModalOpen = true;
		preventScroll();
		
		// Force modal to be visible immediately
		requestAnimationFrame(() => {
			modal.classList.add('active');
			// Double-check modal is visible
			if (modal.style.display !== 'block') {
				modal.style.display = 'block';
			}
			if (!modal.classList.contains('active')) {
				modal.classList.add('active');
			}
		});
		
		// Set iframe src AFTER modal is visible
		iframe.src = 'about:blank';
		
		// Use a tiny delay to ensure about:blank is set, then set the actual URL
		setTimeout(() => {
			iframe.src = docUrl;
			currentDocId = guidelineId;
			isOpeningModal = false; // Reset guard after modal is shown
			
			// Verify modal is actually visible
			setTimeout(() => {
				const computedStyle = window.getComputedStyle(modal);
				console.log('Modal visibility check:', {
					display: computedStyle.display,
					visibility: computedStyle.visibility,
					opacity: computedStyle.opacity,
					zIndex: computedStyle.zIndex,
					hasActiveClass: modal.classList.contains('active')
				});
				
				if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden') {
					console.warn('Modal not visible! Forcing visibility...');
					modal.style.display = 'block';
					modal.style.visibility = 'visible';
					modal.style.opacity = '1';
					modal.classList.add('active');
				}
			}, 100);
		}, 10);
		
		return false;
	}

	function closeChatModal() {
		const modal = document.getElementById('manual-assistant-modal');
		const iframe = document.getElementById('chat-iframe');
		const body = document.body;
		
		modal.classList.remove('active');
		body.classList.remove('modern-modal-open');
		chatModalOpen = false;
		currentDocId = null;
		
		// Reset iframe and hide modal after transition completes
		setTimeout(() => {
			iframe.src = 'about:blank';
			modal.style.display = 'none'; // Hide after transition
		}, 400);
		
		allowScroll();
	}

	let scrollPosition = 0;
	
	function preventScroll() {
		scrollPosition = window.pageYOffset;
		document.body.style.overflow = 'hidden';
		document.body.style.position = 'fixed';
		document.body.style.top = `-${scrollPosition}px`;
		document.body.style.width = '100%';
	}
	
	function allowScroll() {
		document.body.style.overflow = '';
		document.body.style.position = '';
		document.body.style.top = '';
		document.body.style.width = '';
		window.scrollTo(0, scrollPosition);
	}

	document.addEventListener('keydown', function(e) {
		if (e.key === 'Escape' && chatModalOpen) {
			closeChatModal();
		}
	});
</script>