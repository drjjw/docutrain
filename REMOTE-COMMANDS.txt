# Troubleshooting Commands (run these ON the remote server)
# Assume you're already SSH'd in: ssh -i ~/.ssh/drjjw.pub -p 7022 root@162.246.254.111

# 1. Check PM2 status and logs (MOST IMPORTANT)
pm2 status
pm2 logs docutrainio-bot --lines 50 --nostream

# 2. Check if .env file exists
ls -la /home/docutrainio/public_html/.env || echo "❌ .env file MISSING"

# 3. Check if server responds
curl -s http://localhost:3458/api/health || echo "❌ Server not responding"

# 4. Check PM2 detailed info
pm2 info docutrainio-bot

# 5. Check for errors in server.js
cd /home/docutrainio/public_html
node server.js 2>&1 | head -20

# 6. Check port availability
netstat -tuln | grep 3458 || echo "Port 3458 not in use"

# 7. Check disk space
df -h

# 8. Check Node.js version
node --version
npm --version

# 9. Check if dependencies are installed
ls -la node_modules | head -5

# 10. Check file permissions
ls -la server.js package.json
whoami

# 11. Check environment variables (if .env exists)
grep -E "^PORT=|^SUPABASE_URL=" .env 2>/dev/null || echo "Cannot read .env"

# 12. Check process memory usage
pm2 list
free -h

# 13. Monitor PM2 in real-time (Ctrl+C to exit)
pm2 monit

# 14. Full restart
pm2 delete docutrainio-bot
pm2 start server.js --name docutrainio-bot
pm2 save
sleep 3
pm2 logs docutrainio-bot --lines 30 --nostream

# 15. Check recent system logs
journalctl -u pm2-root -n 50 --no-pager 2>/dev/null || dmesg | tail -20


